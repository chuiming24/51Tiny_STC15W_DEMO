C51 COMPILER V9.00   MIAN                                                                  06/29/2018 11:08:45 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MIAN
OBJECT MODULE PLACED IN mian.OBJ
COMPILER INVOKED BY: C:\KeilC51\C51\BIN\C51.EXE mian.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**********************************************************************
   2          ×÷Õß£ºÌ×Ì×
   3          ÓÊÏä£º2011543651@qq.com
   4          ¹¦ÄÜ£ºÓÃÓÚÑÝÊ¾STC15Ê¹ÓÃtiny51ÏµÍ³µÄÀý×Ó
   5                          Ê¹ÓÃkeil¹Ù·½µÄTinyÓÃ´®¿Úº¯Êý½øÐÐ´®¿ÚÃüÁî¶ÁÈ¡²¢»ØÏÔ
   6          
   7          **********************************************************************/
   8          #include <config.H>
   9          #include <stdio.h>
  10          #include <12864.h>
  11          #include <delay.h>
  12          #include <gpio.h>
  13          #include <key.h>
  14          #include "mfrc522.h"
  15          
  16          #define os_enter_critical() ET0=0
  17          #define os_exit_critical()      ET0=1
  18          
  19          unsigned char card_type[20];//¿¨ÀàÐÍ
  20          unsigned char card_key[6] = {0xff,0xff,0xff,0xff,0xff,0xff};//¿¨ÃÜÂë
  21          char code_string[20];
  22          bit flag_rfid  = 0;//±íÊ¾ÊÇ·ñÓÐRFID±êÇ©½Ó´¥×Å¸ÐÓ¦Æ÷
  23          long int card_code;
  24          
  25          long int code card[7] = {
  26          1646022205,
  27          1646445629 ,
  28          2891902230      ,
  29          2892454518       ,
  30          1382879549        ,
  31          1382896445         ,
  32          2892253110
  33          
  34          };
  35          
  36          ///**********************************************************************
  37          //      µÚÒ»¸öÈÎÎñ£¬ÓÃÓÚ³õÊ¼»¯¡£
  38          //**********************************************************************/
  39          //void Init() _task_ 0  {                  
  40          //      gpio();                 
  41          //      Lcd_init();     
  42          //      //
  43          //      os_create_task (1);               //´´½¨µÚÒ»¸öÈÎÎñ      
  44          //      os_create_task (2);               //´´½¨µÚ¶þ¸öÈÎÎñ
  45          //      os_create_task (3);               //´´½¨µÚ¶þ¸öÈÎÎñ
  46          //
  47          //      os_delete_task (0);               //³õÊ¼»¯Íê±Ï£¬É¾³ý×ÔÉíÈÎÎñ
  48          //}
  49          //
  50          /////**********************************************************************
  51          ////    µÚ¶þ¸öÈÎÎñ£¬ÌîÈëÊý¾Ý
  52          ////**********************************************************************/
  53          //void LED1() _task_ 1{
  54          //
  55          //
C51 COMPILER V9.00   MIAN                                                                  06/29/2018 11:08:45 PAGE 2   

  56          //
  57          //}
  58          //
  59          ///**********************************************************************
  60          //      µÚÈý¸öÈÎÎñ£¬ÓÃÓÚ¼üÅÌÉ¨Ãè
  61          //**********************************************************************/
  62          //void LCD1() _task_ 2{
  63          //      char temp_char[20];
  64          //      int key_temp = 0;
  65          //      int i;
  66          //
  67          ////    Lcd_str(1, 0, "¶à¶¯ëÞµç×ÓËø");
  68          ////    P55 = 0;
  69          //      while(1){
  70          //              key_temp = read_keyboard();
  71          //              if(key_temp != 0xff){
  72          ////                    sprintf(temp_char , "%d ºÅ°´¼ü°´ÏÂÁË", key_temp);
  73          ////                    Lcd_str(2, 0, temp_char);
  74          ////                    i++;                    
  75          //              }
  76          //
  77          //              
  78          ////            sprintf(temp_char , "%d number", i);
  79          ////            Lcd_str(3, 0, temp_char);
  80          //      }
  81          //}
  82          ///**********************************************************************
  83          //      µÚÈý¸öÈÎÎñ£¬¿ªËø
  84          //**********************************************************************/
  85          //void LCD2() _task_ 3{
  86          //      uchar i;
  87          //      uchar i_uper = 0;
  88          //      uchar i_downr = 0;
  89          //      while(1){
  90          ////            DIS12864M();
  91          //      }
  92          //}
  93          
  94          
  95          void main(){
  96   1      unsigned char temp,t=0, i = 0;
  97   1      
  98   1              gpio();                 
  99   1              Lcd_init();     
 100   1      
 101   1              Lcd_str(3, 0, "¶à¶¯ëÞµç×ÓËø");
 102   1              while(1){
 103   2                      temp = PcdRequest(PICC_REQALL, card_type);       //¶ÁRFIDµÚÒ»²½£ºÑ°¿¨
 104   2                      if (temp != MI_OK)
 105   2                      {
 106   3                              temp = PcdReset();
 107   3                              PcdAntennaOff();
 108   3                              PcdAntennaOn();
 109   3                              continue; //Ìø³ö¸Ã´ÎÑ­»·£¬½øÐÐµÚ¶þ´ÎÑ­»·¶ÁÈ¡
 110   3                      }
 111   2                      temp = PcdAnticoll(card_type); //¶ÁRFIDµÚ¶þ²½£º·À³å×²
 112   2                      if (temp != MI_OK)
 113   2                              continue;
 114   2      
 115   2                      temp = PcdSelect(card_type); //¶ÁRFIDµÚÈý²½£ºÑ¡¶¨¿¨Æ¬
 116   2                      if (temp != MI_OK)
 117   2                              continue;
C51 COMPILER V9.00   MIAN                                                                  06/29/2018 11:08:45 PAGE 3   

 118   2                      else
 119   2                      {
 120   3      
 121   3                                      //card_type[3]~[0]´æ·Å×Årfid¿¨µÄuidºÅÂë£¬ÊÇ16½øÖÆÂë
 122   3                                      card_code = card_type[3];
 123   3                                      card_code<<=8;//±íÊ¾card_codeÏò×óÒÆ¶¯8¸ö¶þ½øÖÆÎ»£¬Ïàµ±ÓÚ³ËÉÏ2µÄ8´Î·½£¬¿ÉÒÔ²Î¿¼Ê®½øÖÆÏò×óÒÆ¶¯nÎ»¾ÍÏàµ±Ó
             -Ú³ËÉÏ10µÄn´Î·½
 124   3                                      card_code |= card_type[2];
 125   3                                      card_code<<=8;
 126   3                                      card_code |= card_type[1];
 127   3                                      card_code<<=8;
 128   3                                      card_code |= card_type[0];//°ÑuidºÅÂë£¨unsigned long intÀàÐÍ£©¸üÐÂµ½Êý×éÀïÃæ
 129   3      
 130   3      
 131   3                                      sprintf(code_string, "%lu", card_code);//sprintfÖ¸µÄÊÇ×Ö·û´®¸ñÊ½»¯ÃüÁî£¬Ö÷Òª¹¦ÄÜÊÇ°Ñ¸ñÊ½»¯µÄÊý¾ÝÐ´ÈëÄ³
             -¸ö×Ö·û´®ÖÐ,%lu±íÊ¾Êä³öÎÞ·ûºÅ³¤ÕûÐÍÕûÊý£¬±íÊ¾µÄÊÇ½øÐÐ¸ñÊ½»¯ÊäÈëµÄ²ÎÊýµÄ¸ñÊ½    
 132   3                                      Lcd_str(0, 0, code_string);
 133   3      
 134   3                                      for(i = 0; i<7; i++){
 135   4                                              if(card_code == card[i]){
 136   5                                                      Lcd_str(1, 0, "¿ªËø");
 137   5                                                      P36 = 0;
 138   5                                                      Delayms(1500ul);
 139   5                                                      P36 = 1;
 140   5                                                      Delayms(2000ul);
 141   5                                                      Lcd_str(1, 0, "    ");  
 142   5                                              }
 143   4                                      }
 144   3                      }                               
 145   2              
 146   2              }
 147   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    445    ----
   CONSTANT SIZE    =     55    ----
   XDATA SIZE       =     50       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
